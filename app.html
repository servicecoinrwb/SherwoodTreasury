<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sherwood Forest Treasury</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        :root { --forest-green: #0b2916; --gold: #f1c40f; --accent: #e67e22; --paper: #f4ecd8; }
        body { font-family: 'Courier New', monospace; background: var(--forest-green); color: #ecf0f1; display: flex; flex-direction: column; align-items: center; padding: 20px; min-height: 100vh; }
        .container { background: rgba(0,0,0,0.85); border: 2px solid var(--gold); border-radius: 12px; padding: 25px; width: 100%; max-width: 480px; box-shadow: 0 0 25px rgba(0,0,0,0.7); }
        h1 { color: var(--gold); text-align: center; margin-bottom: 5px; text-transform: uppercase; }
        .stat-card { background: #1a1a1a; padding: 12px; border-radius: 6px; margin-bottom: 8px; border-left: 4px solid var(--gold); }
        .stat-label { font-size: 0.75rem; color: var(--gold); text-transform: uppercase; letter-spacing: 1px; }
        .stat-value { font-size: 1.2rem; font-weight: bold; display: block; }
        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 4px; border: none; background: #222; color: white; box-sizing: border-box; font-size: 1rem; }
        button { width: 100%; padding: 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; text-transform: uppercase; margin-top: 10px; transition: 0.2s; font-family: inherit; }
        .btn-gold { background: var(--gold); color: black; }
        .btn-gold:hover { background: #d4ac0d; transform: translateY(-1px); }
        .btn-rob { background: transparent; border: 2px solid var(--accent); color: var(--accent); }
        .btn-rob:hover { background: var(--accent); color: white; }
        .btn-withdraw { background: transparent; border: 1px solid #7f8c8d; color: #7f8c8d; font-size: 0.8rem; margin-top: 20px; }
        .btn-withdraw:hover { border-color: #ecf0f1; color: #ecf0f1; }
        #status { text-align: center; font-size: 0.85rem; margin-top: 15px; color: #2ecc71; font-weight: bold; min-height: 1.5em; }
        .explainer { background: var(--paper); color: #333; padding: 15px; border-radius: 8px; margin-top: 25px; font-size: 0.85rem; border: 1px solid #d4c4a8; }
        .explainer h3 { margin-top: 0; color: #5d4037; border-bottom: 1px solid #d4c4a8; padding-bottom: 5px; }
        .network-btn { background: #e74c3c; color: white; margin-bottom: 15px; }
    </style>
</head>
<body>

    <div class="container">
        <h1>üèπ SHERWOOD FOREST</h1>
        
        <div id="statArea">
            <div class="stat-card"><span class="stat-label">Your Wallet Balance</span><span class="stat-value" id="userEth">0.0000 ETH</span></div>
            <div class="stat-card"><span class="stat-label">Your Quiver (ARROW)</span><span class="stat-value" id="userArrows">0.0000 ARROW</span></div>
            <div class="stat-card"><span class="stat-label">1 Arrow Worth</span><span class="stat-value" id="arrowPrice">1.0000 ETH</span></div>
        </div>

        <button id="connectBtn" class="btn-gold">Connect Outlaw Wallet</button>
        <button id="switchNetBtn" class="network-btn" style="display:none;">Switch to Robinhood Testnet</button>
        
        <div id="ui" style="display:none;">
            <input type="number" id="amt" placeholder="Amount of ETH to Stake" step="0.01">
            <button onclick="doDeposit()" class="btn-gold">Join Merry Men</button>
            
            <button onclick="doRob()" class="btn-rob">‚öîÔ∏è Rob the Sheriff</button>
            
            <div id="status">Ready for an ambush...</div>
            
            <hr style="border: 0; border-top: 1px solid #333; margin: 25px 0 15px 0;">
            <input type="number" id="wAmt" placeholder="Arrows to Burn">
            <button onclick="doWithdraw()" class="btn-withdraw">Return to Village (Withdraw ETH)</button>
        </div>

        <div class="explainer">
            <h3>üìú Scroll of Wisdom</h3>
            <p>1. <b>Stake ETH:</b> Mint ARROW tokens to claim your share of the forest.<br>
               2. <b>Rob the Sheriff:</b> Increases "Ghost Gold" in the treasury, pumping the <b>Arrow Price</b> for everyone.<br>
               3. <b>Withdraw:</b> Burn your arrows to receive your share of the ETH gold back.</p>
        </div>
    </div>

<script>
    // THE CONTRACT ADDRESS YOU PROVIDED
    const ADDR = "0xd435e6D506424AdA0A3BBc06e6d3E3Bf5E2C157D";
    
    // FULL ABI FOR INTERACTION
    const ABI = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"villager","type":"address"},{"indexed":false,"internalType":"uint256","name":"ethAmount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"arrowsMinted","type":"uint256"},{"indexed":false,"internalType":"address","name":"referrer","type":"address"}],"name":"GoldDeposited","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"villager","type":"address"},{"indexed":false,"internalType":"uint256","name":"arrowsBurned","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"ethReturned","type":"uint256"}],"name":"GoldWithdrawn","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"by","type":"address"},{"indexed":false,"internalType":"uint256","name":"goldStolen","type":"uint256"}],"name":"SheriffRobbed","type":"event"},{"inputs":[],"name":"REFERRAL_BONUS_BPS","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"referrer","type":"address"}],"name":"deposit","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"lastRobbery","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pricePerArrow","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"referrers","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"robTheSheriff","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalGhostGold","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalTreasuryValue","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"arrowAmount","type":"uint256"}],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"},{"stateMutability":"payable","type":"receive"}];

    let contract, signer, provider;

    async function init() {
        if (!window.ethereum) return msg("‚ùå Install MetaMask");
        provider = new ethers.BrowserProvider(window.ethereum);
        
        // Auto-reload on wallet changes
        window.ethereum.on('accountsChanged', () => window.location.reload());
        window.ethereum.on('chainChanged', () => window.location.reload());
    }

    async function connect() {
        try {
            const network = await provider.getNetwork();
            if (network.chainId !== 46630n) {
                document.getElementById('switchNetBtn').style.display = 'block';
                return msg("‚ùå Please switch networks.");
            }

            await provider.send("eth_requestAccounts", []);
            signer = await provider.getSigner();
            contract = new ethers.Contract(ADDR, ABI, signer);
            
            document.getElementById('ui').style.display = 'block';
            document.getElementById('connectBtn').style.display = 'none';
            document.getElementById('switchNetBtn').style.display = 'none';
            
            refresh();
            setInterval(refresh, 12000); // Auto-refresh every 12 seconds
        } catch (e) { msg("‚ùå Connection Failed"); }
    }

    async function switchNetwork() {
        try {
            await window.ethereum.request({
                method: "wallet_addEthereumChain",
                params: [{
                    chainId: "0xB626", // 46630 in hex
                    chainName: "Robinhood Chain Testnet",
                    rpcUrls: ["https://rpc.testnet.chain.robinhood.com"],
                    nativeCurrency: { name: "ETH", symbol: "ETH", decimals: 18 },
                    blockExplorerUrls: ["https://explorer.testnet.chain.robinhood.com"]
                }]
            });
        } catch (e) { msg("‚ùå Switch Failed"); }
    }

    async function refresh() {
        try {
            const userAddr = await signer.getAddress();
            const [bal, price, quiver] = await Promise.all([
                provider.getBalance(userAddr),
                contract.pricePerArrow(),
                contract.balanceOf(userAddr)
            ]);
            
            document.getElementById('userEth').innerText = ethers.formatEther(bal).substring(0,8) + " ETH";
            document.getElementById('arrowPrice').innerText = ethers.formatEther(price).substring(0,6) + " ETH";
            document.getElementById('userArrows').innerText = ethers.formatEther(quiver).substring(0,6) + " ARROW";
        } catch(e) { console.warn("Refreshing forest data..."); }
    }

    async function doDeposit() {
        try {
            const eth = document.getElementById('amt').value;
            if(!eth || eth <= 0) return msg("Enter an amount first!");
            const tx = await contract.deposit(ethers.ZeroAddress, { value: ethers.parseEther(eth) });
            msg("‚öîÔ∏è Sending gold to Sherwood...");
            await tx.wait(); // Wait for confirmation
            msg("‚úÖ Success! Welcome Outlaw.");
            refresh();
        } catch(e) { msg("‚ùå Failed: Check your balance."); }
    }

    async function doRob() {
        try {
            const tx = await contract.robTheSheriff();
            msg("üèπ AMBUSHING THE SHERIFF...");
            await tx.wait();
            msg("‚úÖ VICTORY! Wealth redistributed.");
            refresh();
        } catch(e) { msg("‚ùå Sheriff is hiding! Wait a minute."); }
    }

    async function doWithdraw() {
        try {
            const val = document.getElementById('wAmt').value;
            if(!val || val <= 0) return msg("How many arrows?");
            const tx = await contract.withdraw(ethers.parseEther(val));
            msg("üí∞ Cashing out your share...");
            await tx.wait();
            msg("‚úÖ Gold returned to your wallet!");
            refresh();
        } catch(e) { msg("‚ùå Withdrawal failed!"); }
    }

    function msg(m) { document.getElementById('status').innerText = m; }
    
    document.getElementById('connectBtn').onclick = connect;
    document.getElementById('switchNetBtn').onclick = switchNetwork;
    init();
</script>
</body>
</html>
