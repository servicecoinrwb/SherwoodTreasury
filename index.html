<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sherwood Forest Treasury</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        :root { --forest-green: #0b2916; --gold: #f1c40f; --accent: #e67e22; --paper: #f4ecd8; }
        body { font-family: 'Courier New', monospace; background: var(--forest-green); color: #ecf0f1; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { background: rgba(0,0,0,0.85); border: 2px solid var(--gold); border-radius: 12px; padding: 25px; width: 100%; max-width: 480px; box-shadow: 0 0 25px rgba(0,0,0,0.7); }
        h1 { color: var(--gold); text-align: center; margin-bottom: 5px; }
        .stat-card { background: #1a1a1a; padding: 12px; border-radius: 6px; margin-bottom: 8px; border-left: 4px solid var(--gold); }
        .stat-label { font-size: 0.75rem; color: var(--gold); text-transform: uppercase; }
        .stat-value { font-size: 1.2rem; font-weight: bold; display: block; }
        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 4px; border: none; background: #222; color: white; box-sizing: border-box; }
        button { width: 100%; padding: 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; text-transform: uppercase; margin-top: 10px; transition: 0.2s; }
        .btn-gold { background: var(--gold); color: black; }
        .btn-rob { background: transparent; border: 2px solid var(--accent); color: var(--accent); }
        .btn-rob:hover { background: var(--accent); color: white; }
        
        /* Explainer Section */
        .explainer { background: var(--paper); color: #333; padding: 15px; border-radius: 8px; margin-top: 25px; border: 2px solid #d4c4a8; line-height: 1.4; }
        .explainer h3 { margin-top: 0; color: #5d4037; border-bottom: 1px solid #d4c4a8; padding-bottom: 5px; }
        .explainer p { font-size: 0.85rem; margin-bottom: 10px; }
        .explainer ul { padding-left: 20px; font-size: 0.85rem; }
        .explainer li { margin-bottom: 5px; }
        
        #status { text-align: center; font-size: 0.85rem; margin-top: 15px; color: #2ecc71; font-weight: bold; }
        .faucet-link { font-size: 0.75rem; color: var(--gold); text-align: center; display: block; margin-top: 15px; text-decoration: underline; }
    </style>
</head>
<body>

    <div class="container">
        <h1>üèπ SHERWOOD FOREST</h1>
        
        <div id="statArea">
            <div class="stat-card"><span class="stat-label">Your Wallet (ETH)</span><span class="stat-value" id="userEth">0.0000</span></div>
            <div class="stat-card"><span class="stat-label">Your Quiver (ARROW)</span><span class="stat-value" id="userArrows">0.00</span></div>
            <div class="stat-card"><span class="stat-label">1 Arrow = </span><span class="stat-value" id="arrowPrice">1.0000 ETH</span></div>
        </div>

        <button id="connectBtn" class="btn-gold">Connect Wallet</button>
        
        <div id="ui" style="display:none;">
            <input type="number" id="amt" placeholder="Gold (ETH) to Stake" step="0.01">
            <button onclick="doDeposit()" class="btn-gold">Join Merry Men</button>
            <button onclick="doRob()" class="btn-rob">‚öîÔ∏è Rob the Sheriff</button>
            <div id="status">Waiting for an outlaw...</div>
            
            <a href="https://docs.robinhood.com/chain/connecting/" target="_blank" class="faucet-link">Need Testnet ETH? Get it here.</a>
        </div>

        <div class="explainer">
            <h3>üìú Scroll of Wisdom</h3>
            <p>Welcome to Sherwood, villager. Here is how we build our fortune:</p>
            <ul>
                <li><strong>Join the Camp:</strong> Deposit ETH to get <b>ARROW</b> tokens. Your arrows represent your share of the forest's gold.</li>
                <li><strong>Rob the Sheriff:</strong> Every 60 seconds, an outlaw can ambush the Sheriff's carriage. This adds "Ghost Gold" to the forest, increasing the <b>Arrow Price</b> for everyone!</li>
                <li><strong>Profit:</strong> As more outlaws rob the Sheriff, your ARROWs become worth more ETH. You can withdraw more than you put in.</li>
                <li><strong>Strategy:</strong> Rob the Sheriff often to pump your own holdings!</li>
            </ul>
            <p><small><i>*Requires Robinhood Chain Testnet (ChainID: 46630)</i></small></p>
        </div>
    </div>

<script>
    const ADDR = "0xd435e6D506424AdA0A3BBc06e6d3E3Bf5E2C157D";
    const ABI = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"villager","type":"address"},{"indexed":false,"internalType":"uint256","name":"ethAmount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"arrowsMinted","type":"uint256"},{"indexed":false,"internalType":"address","name":"referrer","type":"address"}],"name":"GoldDeposited","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"villager","type":"address"},{"indexed":false,"internalType":"uint256","name":"arrowsBurned","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"ethReturned","type":"uint256"}],"name":"GoldWithdrawn","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"by","type":"address"},{"indexed":false,"internalType":"uint256","name":"goldStolen","type":"uint256"}],"name":"SheriffRobbed","type":"event"},{"inputs":[],"name":"REFERRAL_BONUS_BPS","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"referrer","type":"address"}],"name":"deposit","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"lastRobbery","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pricePerArrow","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"referrers","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"robTheSheriff","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalGhostGold","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalTreasuryValue","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"arrowAmount","type":"uint256"}],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"},{"stateMutability":"payable","type":"receive"}];

    let contract, signer, provider;

    async function connect() {
        if (!window.ethereum) return alert("Install MetaMask Outlaw!");
        provider = new ethers.BrowserProvider(window.ethereum);
        
        const network = await provider.getNetwork();
        if (network.chainId !== 46630n) {
            msg("‚ùå SWITCH TO ROBINHOOD TESTNET!");
            return;
        }

        signer = await provider.getSigner();
        contract = new ethers.Contract(ADDR, ABI, signer);
        document.getElementById('ui').style.display = 'block';
        document.getElementById('connectBtn').style.display = 'none';
        refresh();
        setInterval(refresh, 15000);
    }

    async function refresh() {
        try {
            const userAddr = await signer.getAddress();
            const walletBal = await provider.getBalance(userAddr);
            
            const p = await contract.pricePerArrow();
            const q = await contract.balanceOf(userAddr);
            
            document.getElementById('userEth').innerText = ethers.formatEther(walletBal).substring(0,8) + " ETH";
            document.getElementById('arrowPrice').innerText = ethers.formatEther(p).substring(0,6) + " ETH";
            document.getElementById('userArrows').innerText = ethers.formatEther(q).substring(0,6) + " ARROW";
        } catch(e) { console.warn("Syncing..."); }
    }

    async function doDeposit() {
        try {
            const eth = document.getElementById('amt').value;
            const tx = await contract.deposit("0x0000000000000000000000000000000000000000", { 
                value: ethers.parseEther(eth) 
            });
            msg("Riding to the camp...");
            await tx.wait();
            msg("Gold Secured!");
            refresh();
        } catch(e) { msg("Error: Not enough gold/gas!"); }
    }

    async function doRob() {
        try {
            const tx = await contract.robTheSheriff();
            msg("‚öîÔ∏è AMBUSH IN PROGRESS...");
            await tx.wait();
            msg("Victory! Price Pumped.");
            refresh();
        } catch(e) { msg("Sheriff's guards are alert! Wait."); }
    }

    function msg(m) { document.getElementById('status').innerText = m; }
    document.getElementById('connectBtn').onclick = connect;
</script>
</body>
</html>
