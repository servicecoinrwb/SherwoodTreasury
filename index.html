<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sherwood Forest | $QUIVER & $ARROW</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <style>
        :root { --forest-dark: #0b2916; --gold: #f1c40f; --quiver-blue: #3498db; --arrow-green: #2ecc71; }
        body { font-family: 'Courier New', monospace; background: var(--forest-dark); color: white; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .container { background: rgba(0,0,0,0.9); border: 2px solid var(--gold); border-radius: 15px; padding: 30px; width: 100%; max-width: 500px; box-shadow: 0 0 30px rgba(0,0,0,0.8); }
        h1 { color: var(--gold); text-align: center; text-transform: uppercase; margin-bottom: 20px; }
        .stat-card { background: #111; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 5px solid var(--gold); }
        .stat-quiver { border-left-color: var(--quiver-blue); }
        .stat-label { font-size: 0.7rem; color: #888; text-transform: uppercase; letter-spacing: 1px; }
        .stat-value { font-size: 1.3rem; font-weight: bold; display: block; color: #fff; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; text-transform: uppercase; margin-top: 15px; transition: 0.3s; }
        .btn-gold { background: var(--gold); color: black; }
        .btn-gold:hover { background: #d4ac0d; transform: scale(1.02); }
        #status { text-align: center; font-size: 0.8rem; margin-top: 15px; color: var(--arrow-green); min-height: 1.2em; }
        input { width: 100%; padding: 12px; background: #222; border: 1px solid #444; color: white; margin-top: 10px; box-sizing: border-box; }
    </style></head><body>

    <div class="container">
        <h1>üèπ Sherwood Forest</h1>
        
        <div id="statArea">
            <div class="stat-card"><span class="stat-label">Native Gold (ETH)</span><span class="stat-value" id="userEth">0.0000</span></div>
            <div class="stat-card"><span class="stat-label">Treasury Shares (ARROW)</span><span class="stat-value" id="userArrows">0.0000</span></div>
            <div class="stat-card stat-quiver"><span class="stat-label">Governance (QUIVER)</span><span class="stat-value" id="userQuiver" style="color:var(--quiver-blue)">0.0000</span></div>
        </div>

        <button id="connectBtn" class="btn btn-gold">Connect Outlaw Wallet</button>
        
        <div id="ui" style="display:none;">
            <input type="number" id="amt" placeholder="ETH to Stake" step="0.01">
            <button onclick="doDeposit()" class="btn btn-gold">Join Merry Men</button>
            <button onclick="doRob()" class="btn" style="background:transparent; border:1px solid var(--gold); color:var(--gold);">‚öîÔ∏è Rob the Sheriff</button>
            <div id="status">Ready for ambush...</div>
        </div>
    </div><script>
    // --- UPDATED CONFIGURATION ---
    const QUIVER_ADDR = "0x10F7Efb4Bd544E0436dD4bACe5bf7284D75ea44e"; // Your newly deployed contract
    const ARROW_TREASURY = "0xd435e6D506424AdA0A3BBc06e6d3E3Bf5E2C157D"; 
    
    const ERC20_ABI = ["function balanceOf(address) view returns (uint256)"];
    const TREASURY_ABI = [
        "function balanceOf(address) view returns (uint256)",
        "function deposit(address) payable",
        "function robTheSheriff()"
    ];

    let provider, signer, quiverContract, arrowContract;

    // --- CONNECTION LOGIC ---
    async function connect() {
        if (!window.ethereum) return alert("MetaMask not found! Open this on a browser with MetaMask.");
        
        try {
            document.getElementById('status').innerText = "Connecting to wallet...";
            
            // Forces MetaMask to show the account selection window
            await window.ethereum.request({ method: "eth_requestAccounts" });
            
            provider = new ethers.BrowserProvider(window.ethereum); // Updated for v6
            signer = await provider.getSigner();
            
            const network = await provider.getNetwork();
            if (network.chainId !== 46630n) {
                alert("Switch MetaMask to Robinhood Testnet (Chain ID 46630)");
                return;
            }

            quiverContract = new ethers.Contract(QUIVER_ADDR, ERC20_ABI, signer);
            arrowContract = new ethers.Contract(ARROW_TREASURY, TREASURY_ABI, signer);

            document.getElementById('ui').style.display = 'block';
            document.getElementById('connectBtn').style.display = 'none';
            document.getElementById('status').innerText = "Connected to Sherwood!";
            
            refresh();
            setInterval(refresh, 15000); 
        } catch (e) {
            console.error(e);
            document.getElementById('status').innerText = "Connection failed. Try again.";
        }
    }

    // --- REFRESH BALANCES ---
    async function refresh() {
        try {
            const addr = await signer.getAddress();
            const [eth, arrows, quiver] = await Promise.all([
                provider.getBalance(addr),
                arrowContract.balanceOf(addr),
                quiverContract.balanceOf(addr).catch(() => 0n) // Safety if QUIVER isn't deployed yet
            ]);

            document.getElementById('userEth').innerText = ethers.formatEther(eth).substring(0,8) + " ETH";
            document.getElementById('userArrows').innerText = ethers.formatEther(arrows).substring(0,6) + " ARROW";
            document.getElementById('userQuiver').innerText = ethers.formatUnits(quiver, 18).toLocaleString() + " QUIVER";
        } catch (err) {
            console.warn("Refresh failed: ", err);
        }
    }

    // --- CONTRACT ACTIONS ---
    async function doDeposit() {
        try {
            const val = document.getElementById('amt').value;
            if(!val || val <= 0) return alert("Enter an amount!");
            
            const tx = await arrowContract.deposit(ethers.ZeroAddress, { 
                value: ethers.parseEther(val) 
            });
            document.getElementById('status').innerText = "Riding into the forest...";
            await tx.wait(); // Wait for confirmation
            document.getElementById('status').innerText = "Success! You are a Merry Man.";
            refresh();
        } catch (e) {
            document.getElementById('status').innerText = "Deposit failed. Insufficient ETH?";
        }
    }

    async function doRob() {
        try {
            const tx = await arrowContract.robTheSheriff();
            document.getElementById('status').innerText = "Ambushing the Sheriff...";
            await tx.wait();
            document.getElementById('status').innerText = "Loot secured! Price pumped.";
            refresh();
        } catch (e) {
            document.getElementById('status').innerText = "Sheriff's guards are alert! Try later.";
        }
    }

    // Listeners for account/network changes
    if (window.ethereum) {
        window.ethereum.on('accountsChanged', () => window.location.reload());
        window.ethereum.on('chainChanged', () => window.location.reload());
    }

    document.getElementById('connectBtn').onclick = connect;
</script></body></html>
